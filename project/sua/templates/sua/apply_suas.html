<!doctype html>
{% load staticfiles %}
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="{% static 'sua/css/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'sua/css/fileinput.min.css' %}" media="all" type="text/css" />

  <!-- My CSS -->
  <link rel="stylesheet" type="text/css" href="{% static 'sua/css/app.css' %}">

  <title>申请团体公益时</title>
</head>

<body style="background-color: #EEEEEE">
  <nav class="navbar fixed-top navbar-expand-lg navbar-dark" style="background-color: #4d4d4d;">
    <a class="navbar-brand mr-auto hide-desktop" href="/">
      <img src="{% static 'sua/images/logo-icon3.png' %}" width="30" height="30" class="d-inline-block align-top" alt="">
      数院公益时
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="/">
            &lt; 返回主页 <span class="sr-only">(current)</span>
          </a>
        </li>
      </ul>
      <a class="navbar-brand mr-auto hide-mobile" href="/">
        <img src="{% static 'sua/images/logo-icon3.png' %}" width="30" height="30" class="d-inline-block align-top" alt="">
        数院公益时
      </a>
      <ul class="navbar-nav my-2 my-lg-0">
        <li class="nav-item dropdown active">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            <img src="{% static 'sua/images/plus.png' %}" width="15" height="15" class="d-inline-block" alt="" style="mix-blend-mode: #fff">
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="/applications/apply/">新增团体公益时申请</a>
          </div>
        </li>
        <li class="nav-item dropdown active">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            {% if nav.user.student == None %}
            {{ nav.user.username }}
            {% else %}
            {{ nav.user.student.name }}
            {% endif %}
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
            {% if not nav.user.student == None %}
              <a class="dropdown-item" href="/students/{{ nav.student.id }}/detail/">我的信息</a>
              <div class="dropdown-divider"></div>
            {% endif %}
            <a class="dropdown-item" href="/logout">登出</a>
          </div>
        </li>
      </ul>
    </div>
  </nav>

  <div class="container mt-5 pt-5">
    <div class="page-head">
      <h2 class="page-head-title">申请团体公益时</h2>
      <nav aria-label="breadcrumb" role="navigation">
        <ol class="breadcrumb page-head-nav">
          <li class="breadcrumb-item"><a href="#">主页</a></li>
          <li class="breadcrumb-item active">申请团体公益时</li>
        </ol>
      </nav>
    </div>
    <div class="row main-content">
      <div class="col-lg">
        <div class="invoice">
          <form id="form" enctype="multipart/form-data" role="form" action="" method="POST" data-parsley-validate>
              {% csrf_token %}
            <div class="row invoice-form-header">
              <div class="col-sm-7">
                <div class="invoice-logo"></div>
              </div>
              <div class="col-sm-5 invoice-order">
                <span class="invoice-id">申请团体公益时</span>
              </div>
            </div>


            <h3 class="pt-5">活动信息：</h3>
            <div class="form-group pt-3">
              <label class="required">活动名称</label>
              <input name="title" class="form-control" type="text" placeholder="请填写您所参加的公益时活动名称" data-parsley-trigger="focusout"
                required>
            </div>
            <div class="form-group pt-3">
              <label class="required">活动详情</label>
              <textarea name="detail" class="form-control" rows=5 type="text" placeholder="请填写该公益时活动的详情"></textarea>
            </div>
            <div class="form-group pt-3">
              <label class="required">活动组织单位</label>
              <input name="group" class="form-control" type="text" placeholder="请填写该公益时活动组织单位的名称" data-parsley-trigger="focusout"
                required>
            </div>
            <div class="form-group pt-3">
              <label class="required">活动开始时间</label>
              <input name="start" class="form-control" type="date">
            </div>
            <div class="form-group pt-3">
              <label class="required">活动结束时间</label>
              <input name="end" class="form-control" type="date">
            </div>

            <h3 class="pt-5">参与人信息：</h3>
            <div class="form-group form-participants" id="participants">
              <div class="form-group form-participant">
                <div class="form-group pt-3">
                  <label class="required">学号</label>
                  <input name="number" class="form-control" type="text" placeholder="请填写参与者的学号"
                    required>
                </div>
                <div class="form-group pt-3">
                  <label class="required">参与组别</label>
                  <input name="team" class="form-control" type="text"
                    placeholder="请填写参与者在该公益时活动参加的小组名称" required>
                </div>
                <div class="form-group pt-3">
                  <label class="required">公益时数</label>
                  <input name="suahours" class="form-control" type="number" step="0.01" placeholder="请填写参与者在该公益时活动中获得的公益时数"
                    data-parsley-trigger="focusout" required>
                </div>
              </div>
            </div>
            <div class="pb-5">
              <div class="form-participant-operator" id="add-participant">添加参与人&nbsp;<i class="fas fa-plus"></i></div>
            </div>

            <h3 class="pt-5">联系方式：</h3>
            <div class="form-group pt-3">
              <label>活动组织单位负责人联系电话</label>
              <input name="contact" class="form-control" type="tel" placeholder="请填写活动组织单位的联系电话：如13612341234"
                data-parsley-trigger="focusout" pattern="^(((\+?\d{1,4}-)?(\d{11}|\d{7,9}|\d{1,4}-\d{7,9}))|\(\d{1,4}\)\d{7,9})$" data-parsley-pattern-message="请填写正确的电话号码">
            </div>

            <h3 class="pt-5">提交相关证明：</h3>
            <div class="form-group pt-3">
              <label class="col-12 col-sm-2 col-form-label text-sm-right">线下证明：</label>
              <input id="inputOffline" type="checkbox" name="is_offline">
            </div>
            <div id="inputFiles" class="form-group pt-3">
              <label class="col-12 col-sm-2 col-form-label text-sm-right">证明文件：</label>
              <!-- <label for="inputFilesEle" class="fileLabel btn btn-lg btn-space btn-secondary">上传文件</label> -->
              <input id="inputFilesEle" name="proof_file" type="file" class="file" multiple>
              <!-- <input id="inputFilesEle" name="proof_file" type="file" multiple="true"> -->
            </div>
            <div class="row invoice-footer">
              <div class="col-lg-12">
                <button type="submit" class="btn btn-lg btn-space btn-primary">提交</button>
                <a class="btn btn-lg btn-space btn-secondary" href="/">返回</a>
              </div>
            </div>
          </form>
        </div>
      </div>

    </div>

  </div>
  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="{% static 'sua/js/jquery-3.3.1.min.js' %}"></script>
  <script src="{% static 'sua/js/popper.min.js' %}"></script>
  <script src="{% static 'sua/js/bootstrap.min.js' %}"></script>
  <script src="{% static 'sua/js/parsley.min.js' %}"></script>
  <script src="{% static 'sua/js/i18n/zh_cn.js' %}"></script>
  <script src="{% static 'sua/js/i18n/zh_cn.extra.js' %}"></script>
  <script src="{% static 'sua/js/piexif.min.js' %}" type="text/javascript"></script>
  <script src="{% static 'sua/js/fileinput.min.js' %}"></script>
  <script src="{% static 'sua/js/i18n/bootstrap-fileinput/zh.js' %}"></script>
  <script>
    $(document).ready(function() {
      var participantCount = 1;
      $("#participants>.form-participant").first().attr("id", `participant-${participantCount}`)
      $('#inputFilesEle').fileinput({
          language: 'zh',
          showUpload: false,
          browseClass: 'btn btn-secondary btn-lg',
      })
      $('#inputOffline').ready(function () {
        if ($('#inputOffline').prop('checked')) {
          $('#inputFiles').css('display', 'none')
        } else {
          $('#inputFiles').css('display', 'block')
        }
      })
      $('#inputOffline').change(function () {
        if (!$(this).prop('checked')) {
          $('#inputFiles').css('display', 'block')
        } else {
          $('#inputFiles').css('display', 'none')
        }
      })

      var formToCopy = ["team", "suahours"]

      $("#add-participant").on("click", function() {
        ++participantCount;

        var participants = $("#participants")
        var participantsArr = participants.children()

        var info = {}
        var lastParticipantInput = function(name) {
          return participants.children().last().find(`input[name=${name}]`)
        }
        formToCopy.map(function(name) {
          info[name] = lastParticipantInput(name).val()
        })

        participants.append(
          `<div class="form-group form-participant" id="participant-${participantCount}">
          <div class="float-right">
            <div class="form-participant-operator" id="remove-participant-${participantCount}">
              删除参与人&nbsp;<i class="fas fa-times"></i>
            </div>
          </div>
            ${participantsArr[0].innerHTML}
          </div>`)

        formToCopy.map(function(name) {
          lastParticipantInput(name).val(info[name])
        })

        var removeButton = $(`#remove-participant-${participantCount}`)
        var formId = `#participant-${participantCount}`
        removeButton.on("click", function() {
          $(formId).remove()
        })
      })
    })
  </script>
</body>

</html>
